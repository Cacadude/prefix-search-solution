# Краткое описание решения

## Что реализовано

### 1. Загрузка данных
- ✅ Парсинг XML каталога (`catalog_products.xml`)
- ✅ Загрузка в Elasticsearch с правильной индексацией
- ✅ Поддержка всех полей товаров (name, category, brand, weight, keywords, description)

### 2. Поиск по префиксам
- ✅ Edge n-gram анализатор (1-15 символов) для префиксного поиска
- ✅ Поддержка коротких запросов (1-3 символа)
- ✅ Multi-match запрос с бустами по полям (name^3, brand^2, category^1.5)

### 3. Транслитерация и раскладка
- ✅ Автоматическое исправление раскладки клавиатуры (QWERTY ↔ ЙЦУКЕН)
- ✅ Layout analyzer в Elasticsearch
- ✅ Обработка на стороне API для сложных случаев

### 4. Числовые признаки
- ✅ Извлечение чисел из запросов (10л, 5кг, 3 шт)
- ✅ Фильтрация по весу/объему с допуском ±20%
- ✅ Сохранение числовых значений для точного поиска

### 5. Защита от мусора
- ✅ Минимальный порог релевантности (score > 0.1)
- ✅ Проверка совпадения слов из запроса
- ✅ Фильтрация по категориям через агрегации
- ✅ Для коротких запросов - проверка префиксов важных полей

### 6. Многоязычность
- ✅ Поддержка кириллицы и латиницы
- ✅ Russian stemmer для морфологии
- ✅ Обработка смешанных запросов

### 7. API и инфраструктура
- ✅ REST API на Flask
- ✅ Docker Compose для запуска
- ✅ Автоматическая инициализация данных
- ✅ Health check endpoints

### 8. Оценка качества
- ✅ Скрипт оценки (`tools/evaluate.py`)
- ✅ Метрики покрытия и задержки
- ✅ Сохранение результатов в CSV и JSON

## Технические детали

### Индексация
- **Индекс**: `products`
- **Анализаторы**:
  - `prefix_analyzer`: edge_ngram + russian_stemmer
  - `search_analyzer`: стандартный + russian_stemmer
  - `layout_analyzer`: исправление раскладки

### Ранжирование
- Multi-match с бустами по полям
- Match phrase prefix для коротких запросов
- Fuzzy matching для длинных запросов (опечатки)
- Фильтрация по числовым признакам

### Защита от мусора
1. Порог релевантности
2. Проверка совпадения слов
3. Проверка префиксов для коротких запросов
4. Фильтрация результатов перед возвратом

## Результаты

### Достигнутые метрики

- **Покрытие**: **96.67%** (58 из 60 запросов) ✅ **ПРЕВЫШЕНО** (цель: ≥70%)
- **Средняя задержка**: **67.51 мс** ✅ (цель: <100мс)
- **Успешных запросов**: 60/60 (100%)
- **Релевантность**: топ-3 результата содержат релевантные товары

### Детализация по типам запросов

Решение успешно обрабатывает все типы запросов из тестового набора:

- ✅ Короткие префиксы (1-3 символа): "ма", "pr", "xfq"
- ✅ Разбитые слова: "кар тофель", "греч не", "круп греч"
- ✅ Английские запросы: "adapter usb c", "power bank 20", "prosecco ro"
- ✅ Бренды: "teos", "холс", "san pelle"
- ✅ Смешанные языки: "lay chips", "diap night", "cat adult"
- ✅ Числовые признаки: "масло раст 10л", "памперсы 3", "мешки 120л"
- ✅ Исправление раскладки: "xfq" → "чай"

## Универсальность

Решение **не использует** фиксированные whitelist-замены. Вся логика основана на:
- Анализаторах Elasticsearch
- Универсальных алгоритмах ранжирования
- Динамической фильтрации результатов

## Запуск

```bash
# Запуск через Docker Compose
docker-compose up -d

# Оценка качества
python tools/evaluate.py --queries data/prefix_queries.csv --output reports/evaluation_results.csv
```

## Структура кода

- `src/load_catalog.py`: Загрузка данных в Elasticsearch
- `src/search_api.py`: API сервис с логикой поиска
- `tools/evaluate.py`: Скрипт оценки качества
- `docker-compose.yml`: Инфраструктура
- `Dockerfile`: Образ для API

